
### **REST API Эндпоинты для Профиля Пользователя (`/profile`)**

Эти эндпоинты обеспечивают взаимодействие с различными микросервисами (в основном **User Service**, **Auth Service**, **Order Service**, **Review Service**, **Payment Service**, **Notification Service**), позволяя пользователю управлять своей информацией, заказами, предпочтениями и настройками безопасности.

-----

#### **1. Мои данные / Личная информация**

* **Получение личной информации пользователя:**

    * `GET /api/users/me`
    * **Микросервис:** `User Service`
    * **Описание:** Получает основные данные текущего аутентифицированного пользователя (имя, фамилия, email, телефон, дата рождения, пол, ссылка на аватар).
    * **Авторизация:** Требуется (JWT)

* **Обновление личной информации пользователя:**

    * `PUT /api/users/me`
    * **Микросервис:** `User Service`
    * **Описание:** Обновляет данные текущего пользователя.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса (пример):**
      ```json
      {
        "firstName": "Айгерим",
        "lastName": "Муратбекова",
        "phone": "+996777123456",
        "dateOfBirth": "1990-05-15",
        "gender": "FEMALE",
        "avatarUrl": "https://example.com/avatars/user123.jpg"
      }
      ```

* **Изменение пароля:**

    * `POST /api/auth/change-password`
    * **Микросервис:** `Auth Service`
    * **Описание:** Позволяет пользователю сменить свой пароль.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса:**
      ```json
      {
        "currentPassword": "old_secure_password",
        "newPassword": "new_strong_password"
      }
      ```

-----

#### **2. Мои заказы (Order History)**

* **Получение списка заказов пользователя:**

    * `GET /api/orders/my-orders`
    * **Микросервис:** `Order Service`
    * **Описание:** Получает список всех заказов текущего пользователя. Поддерживает параметры пагинации, сортировки и фильтрации по статусу.
    * **Авторизация:** Требуется (JWT)
    * **Пример:** `/api/orders/my-orders?page=0&size=10&status=DELIVERED`

* **Получение деталей конкретного заказа:**

    * `GET /api/orders/{orderId}`
    * **Микросервис:** `Order Service`
    * **Описание:** Предоставляет детальную информацию о конкретном заказе по его уникальному идентификатору.
    * **Авторизация:** Требуется (JWT)

* **Повтор заказа:**

    * `POST /api/orders/{orderId}/repeat`
    * **Микросервис:** `Order Service`
    * **Описание:** Создает новый заказ, копируя товары из существующего заказа в корзину или сразу оформляя новый заказ.
    * **Авторизация:** Требуется (JWT)

-----

#### **3. Избранное (Favorites/Wishlist)**

* **Получение списка избранных товаров:**

    * `GET /api/users/me/favorites`
    * **Микросервис:** `User Service` (или отдельный `Wishlist Service`)
    * **Описание:** Получает список всех товаров, которые пользователь добавил в избранное.
    * **Авторизация:** Требуется (JWT)

* **Добавление товара в избранное:**

    * `POST /api/users/me/favorites/{productId}`
    * **Микросервис:** `User Service`
    * **Описание:** Добавляет товар с указанным `productId` в список избранного пользователя.
    * **Авторизация:** Требуется (JWT)

* **Удаление товара из избранного:**

    * `DELETE /api/users/me/favorites/{productId}`
    * **Микросервис:** `User Service`
    * **Описание:** Удаляет товар с указанным `productId` из списка избранного пользователя.
    * **Авторизация:** Требуется (JWT)

-----

#### **4. Отзывы (My Reviews)**

* **Получение списка отзывов, оставленных пользователем:**

    * `GET /api/reviews/my-reviews`
    * **Микросервис:** `Review Service`
    * **Описание:** Получает все отзывы и оценки, которые текущий пользователь оставил на платформе.
    * **Авторизация:** Требуется (JWT)

* **Редактирование своего отзыва:**

    * `PUT /api/reviews/{reviewId}`
    * **Микросервис:** `Review Service`
    * **Описание:** Обновляет текст или оценку существующего отзыва, принадлежащего пользователю.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса (пример):**
      ```json
      {
        "rating": 4,
        "comment": "Отличный товар, но доставка была немного дольше."
      }
      ```

* **Удаление своего отзыва:**

    * `DELETE /api/reviews/{reviewId}`
    * **Микросервис:** `Review Service`
    * **Описание:** Удаляет отзыв, созданный текущим пользователем.
    * **Авторизация:** Требуется (JWT)

-----

#### **5. Адреса доставки (Shipping Addresses)**

* **Получение списка адресов доставки пользователя:**

    * `GET /api/users/me/addresses`
    * **Микросервис:** `User Service`
    * **Описание:** Получает список всех сохраненных адресов для доставки текущего пользователя.
    * **Авторизация:** Требуется (JWT)

* **Добавление нового адреса доставки:**

    * `POST /api/users/me/addresses`
    * **Микросервис:** `User Service`
    * **Описание:** Добавляет новый адрес доставки в профиль пользователя.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса (пример):**
      ```json
      {
        "street": "Ул. Абдрахманова",
        "house": "150",
        "apartment": "25",
        "city": "Бишкек",
        "zipCode": "720001",
        "isDefault": true,
        "label": "Домашний адрес"
      }
      ```

* **Обновление существующего адреса доставки:**

    * `PUT /api/users/me/addresses/{addressId}`
    * **Микросервис:** `User Service`
    * **Описание:** Обновляет данные существующего адреса доставки пользователя.
    * **Авторизация:** Требуется (JWT)

* **Удаление адреса доставки:**

    * `DELETE /api/users/me/addresses/{addressId}`
    * **Микросервис:** `User Service`
    * **Описание:** Удаляет указанный адрес доставки из профиля пользователя.
    * **Авторизация:** Требуется (JWT)

-----

#### **6. Способы оплаты (Payment Methods)**

* **Получение списка сохраненных способов оплаты:**

    * `GET /api/payments/me/methods`
    * **Микросервис:** `Payment Service`
    * **Описание:** Получает список токенизированных или сохраненных платежных методов пользователя (например, последние 4 цифры карты, тип карты). **Полные данные карты не передаются.**
    * **Авторизация:** Требуется (JWT)

* **Добавление нового способа оплаты:**

    * `POST /api/payments/me/methods`
    * **Микросервис:** `Payment Service`
    * **Описание:** Добавляет новый способ оплаты. Обычно это включает токенизацию данных карты через внешний платежный шлюз.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса:** Зависит от интеграции с платежным шлюзом (обычно содержит токен, полученный от фронтенда после ввода данных карты).

* **Удаление способа оплаты:**

    * `DELETE /api/payments/me/methods/{methodId}`
    * **Микросервис:** `Payment Service`
    * **Описание:** Удаляет сохраненный способ оплаты.
    * **Авторизация:** Требуется (JWT)

-----

#### **7. Поддержка / Мои обращения**

* **Получение списка обращений пользователя в поддержку:**

    * `GET /api/support/my-tickets`
    * **Микросервис:** `Support Service` (или часть `User Service`)
    * **Описание:** Получает список всех обращений, которые пользователь создавал в службу поддержки.
    * **Авторизация:** Требуется (JWT)

* **Создание нового обращения:**

    * `POST /api/support/tickets`
    * **Микросервис:** `Support Service`
    * **Описание:** Создает новое обращение в службу поддержки.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса (пример):**
      ```json
      {
        "subject": "Проблема с заказом #12345",
        "message": "Мой товар не был доставлен в срок...",
        "orderId": "12345"
      }
      ```

* **Получение истории сообщений по обращению:**

    * `GET /api/support/tickets/{ticketId}/messages`
    * **Микросервис:** `Support Service`
    * **Описание:** Получает всю переписку в рамках конкретного обращения.
    * **Авторизация:** Требуется (JWT)

* **Отправка сообщения в обращении:**

    * `POST /api/support/tickets/{ticketId}/messages`
    * **Микросервис:** `Support Service`
    * **Описание:** Отправляет новое сообщение в рамках существующего обращения.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса:**
      ```json
      {
        "text": "Уточните, пожалуйста, статус доставки."
      }
      ```

-----

#### **8. Настройки уведомлений**

* **Получение текущих настроек уведомлений:**

    * `GET /api/notifications/me/settings`
    * **Микросервис:** `Notification Service`
    * **Описание:** Получает текущие предпочтения пользователя по типам и каналам уведомлений (email, SMS, push).
    * **Авторизация:** Требуется (JWT)

* **Обновление настроек уведомлений:**

    * `PUT /api/notifications/me/settings`
    * **Микросервис:** `Notification Service`
    * **Описание:** Обновляет предпочтения пользователя по получению уведомлений.
    * **Авторизация:** Требуется (JWT)
    * **Тело запроса (пример):**
      ```json
      {
        "emailEnabled": true,
        "smsEnabled": false,
        "pushEnabled": true,
        "orderStatusUpdates": true,
        "promotions": false
      }
      ```

-----

#### **9. Безопасность**

* **Получение истории входов:**

    * `GET /api/auth/me/login-history`
    * **Микросервис:** `Auth Service`
    * **Описание:** Получает список последних входов в аккаунт пользователя (с указанием времени, IP-адреса, типа устройства).
    * **Авторизация:** Требуется (JWT)

* **Включение 2FA (Двухфакторной аутентификации):**

    * `POST /api/auth/me/2fa/enable`
    * **Микросервис:** `Auth Service`
    * **Описание:** Инициирует процесс включения двухфакторной аутентификации для аккаунта.
    * **Авторизация:** Требуется (JWT)
    * **Примечание:** Может потребовать дополнительного шага подтверждения (например, ввод кода из SMS/аутентификатора).

* **Отключение 2FA:**

    * `POST /api/auth/me/2fa/disable`
    * **Микросервис:** `Auth Service`
    * **Описание:** Отключает двухфакторную аутентификацию. Требуется подтверждение паролем или другим способом.
    * **Авторизация:** Требуется (JWT)

* **Получение списка активных сессий/устройств:**

    * `GET /api/auth/me/sessions`
    * **Микросервис:** `Auth Service`
    * **Описание:** Показывает список всех активных сессий пользователя на разных устройствах.
    * **Авторизация:** Требуется (JWT)

* **Завершение конкретной активной сессии:**

    * `DELETE /api/auth/me/sessions/{sessionId}`
    * **Микросервис:** `Auth Service`
    * **Описание:** Позволяет пользователю принудительно выйти из активной сессии на другом устройстве по её ID.
    * **Авторизация:** Требуется (JWT)

-----

Эти эндпоинты, маршрутизируемые через **API Gateway**, обеспечат надежное и эффективное взаимодействие между фронтендом профиля пользователя и бэкенд-микросервисами.