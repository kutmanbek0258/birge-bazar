# Review Service

Этот сервис отвечает за управление отзывами о продуктах в системе Birge-Bazar.

## Описание

Сервис позволяет аутентифицированным пользователям создавать, обновлять, удалять и просматривать отзывы о продуктах. Он предоставляет REST API для взаимодействия с другими сервисами и клиентскими приложениями и защищен с помощью OAuth2.

## Технологии

*   **Java 17**
*   **Spring Boot 3.2.5**
*   **Spring Cloud**
*   **PostgreSQL**
*   **Liquibase** - для управления миграциями базы данных
*   **Maven** - для сборки проекта

## API Endpoints

Все эндпоинты доступны по префиксу `/api/v1/reviews` и требуют валидного Bearer Token.

---

### 1. Создать отзыв

*   **POST** `/`
*   **Описание:** Создает новый отзыв для продукта. Пользователь может оставить только один отзыв на один продукт.
*   **Тело запроса:**

```json
{
  "productId": 123,
  "rating": 5,
  "comment": "Отличный продукт! Очень доволен."
}
```

*   **Ответ (201 Created):**

```json
{
  "id": 1,
  "productId": 123,
  "userId": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "rating": 5,
  "comment": "Отличный продукт! Очень доволен.",
  "createdAt": "2025-08-04T10:00:00Z",
  "updatedAt": "2025-08-04T10:00:00Z"
}
```

*   **Ошибки:**
    *   `409 Conflict`: Если пользователь уже оставлял отзыв на этот продукт.
    *   `401 Unauthorized`: Если токен не предоставлен или недействителен.

---

### 2. Получить отзывы по ID продукта

*   **GET** `/product/{productId}`
*   **Описание:** Возвращает постраничный список отзывов для указанного продукта.
*   **Параметры запроса:**
    *   `page`: `int` (по умолчанию `0`) - номер страницы.
    *   `size`: `int` (по умолчанию `20`) - количество элементов на странице.
*   **Ответ (200 OK):**

```json
{
  "content": [
    {
      "id": 1,
      "productId": 123,
      "userId": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "rating": 5,
      "comment": "Отличный продукт!",
      "createdAt": "2025-08-04T10:00:00Z",
      "updatedAt": "2025-08-04T10:00:00Z"
    }
  ],
  "pageable": { ... },
  "totalElements": 1,
  "totalPages": 1,
  "last": true,
  ...
}
```

---

### 3. Получить сводку по отзывам продукта

*   **GET** `/product/{productId}/summary`
*   **Описание:** Возвращает средний рейтинг и общее количество отзывов для продукта.
*   **Ответ (200 OK):**

```json
{
  "averageRating": 4.8,
  "totalReviews": 25
}
```

---

### 4. Получить отзывы текущего пользователя

*   **GET** `/user/me`
*   **Описание:** Возвращает постраничный список отзывов, оставленных текущим пользователем.
*   **Ответ (200 OK):** Аналогичен ответу на получение отзывов по продукту.

---

### 5. Обновить отзыв

*   **PUT** `/{reviewId}`
*   **Описание:** Позволяет пользователю обновить свой отзыв.
*   **Тело запроса:**

```json
{
  "rating": 4,
  "comment": "Продукт хороший, но доставка была долгой."
}
```

*   **Ответ (200 OK):** Обновленный объект отзыва.
*   **Ошибки:**
    *   `404 Not Found`: Если отзыв с таким ID не найден.
    *   `409 Conflict`: Если пользователь пытается обновить не свой отзыв.

---

### 6. Удалить отзыв

*   **DELETE** `/{reviewId}`
*   **Описание:** Позволяет пользователю удалить свой отзыв.
*   **Ответ (204 No Content):** Пустой ответ в случае успеха.
*   **Ошибки:**
    *   `404 Not Found`: Если отзыв с таким ID не найден.
    *   `409 Conflict`: Если пользователь пытается удалить не свой отзыв.

## Локальный запуск

1.  **Настройте базу данных:**
    *   Убедитесь, что у вас запущен PostgreSQL.
    *   Создайте базу данных (например, `review_db`) и схему (`reviews`).
    *   Настройте подключение в `application.yml` или через переменные окружения.

2.  **Запустите зависимости:**
    *   Убедитесь, что запущены `config-server`, `discovery-server` и `auth-service`.

3.  **Сборка и запуск:**
    *   Выполните команду Maven для сборки проекта:
        ```bash
        mvn clean install
        ```
    *   Запустите приложение:
        ```bash
        java -jar target/review-service.jar
        ```
